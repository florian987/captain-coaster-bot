#image: $CI_REGISTRY_IMAGE:ci
image: registry.gitlab.com/jffz/discordbot:ci

variables:
  PIPENV_CACHE_DIR: "$CI_PROJECT_DIR/pipenv-cache"

cache:
  paths:
    - "$CI_PROJECT_DIR/pipenv-cache"
    - "$CI_PROJECT_DIR/.venv"

stages:
  - test
  - build

test:
  stage: test

  script:
    - pipenv sync -d
    #- pipenv install --deploy --system --ignore-pipfile 
    - python -m flake8 -v
    #- pipenv run lint --exit-zero 

build:
  services:
    - docker:dind

  stage: build
  script:
    - sh scripts/deploy.sh
